# 📑 README

## 🔗 目次

- [🏡 非IT（一般）ユーザー向け 説明書（README）](#非it一般ユーザー向け-説明書readme)
  - [🏡 はじめに](#はじめに)
  - [⚙️ 道具の準備（必要なもの）](#道具の準備必要なもの)
  - [🚀 使い方（定義と具体例）](#使い方定義と具体例)
- [👨‍💻 エンジニア向け 説明書（README）](#エンジニア向け-説明書readme)
  - [🎯 プロジェクト概要](#プロジェクト概要)
  - [🛠️ 依存関係と環境](#依存関係と環境)
  - [📂 主要機能と技術詳細](#主要機能と技術詳細)
    - [1. 動画ダウンロード (YouTube・TVer・ABEMAダウンロード用.bat)](#1-動画ダウンロード-youtubetverabemaダウンロード用bat)
    - [2. 動画の拡張子を変更（コンテナコピー） (動画の拡張子を変更（未劣化）.bat)](#2-動画の拡張子を変更コンテナコピー-動画の拡張子を変更未劣化bat)
    - [3. 動画から音声抽出 (動画から音声抽出.bat)](#3-動画から音声抽出-動画から音声抽出bat)
    - [4. 音声の拡張子を変更（再エンコード） (音声の拡張子を変更（未圧縮）.bat)](#4-音声の拡張子を変更再エンコード-音声の拡張子を変更未圧縮bat)
    - [5. 画像形式変換 (画像形式変換.bat)](#5-画像形式変換-画像形式変換bat)
    - [6. yt-dlp更新 (yt-dlp更新用.bat)](#6-yt-dlp更新-yt-dlp更新用bat)
  - [⚙️ 改善点の提案](#改善点の提案)

## 🏡 非IT（一般）ユーザー向け 説明書（README）

### 🏡 はじめに

このフォルダにあるファイルは、動画のダウンロード、音楽や画像の形式を変える作業を、**マウスの操作だけで簡単に実行できる**ようにするための道具です。

### ⚙️ 道具の準備（必要なもの）

これらの道具（バッチファイル）を使うためには、いくつかの「**特別な道具**」をパソコンに入れておく必要があります。もしこれらの道具がないと、バッチファイルは動かずにエラーで止まってしまいます。

| バッチファイルの種類 | 必要な道具 |
| --- | --- |
| 動画ダウンロード、更新 | **`yt-dlp.exe`** |
| 動画・音声の変換、抽出 | **`ffmpeg.exe`** |
| 画像の変換 | **`magick.exe`** (ImageMagick) |

> **【重要】道具の置き場所について**
> バッチファイルは、これらの道具（`yt-dlp.exe`、`ffmpeg.exe`、`magick.exe`など）を**探します**。道具を見つけられるように、以下のどちらかの方法で配置してください。
> 1. **最も簡単な方法**：これらの道具（`.exe`ファイル）を、**バッチファイルと同じフォルダ**の中に置いてください。
> 2. **上級者向けの方法**：これらの道具がパソコンのどこにあっても見つけられるように、「**パスを通す**」という設定をしてください。

> 💡 **確認方法**
> * `YouTube・TVer・ABEMAダウンロード用.bat` や `音声の拡張子を変更（未圧縮）.bat` などを実行して「[エラー] xxx.exe が見つかりません」というメッセージが出た場合、道具の配置が間違っています。

### 🚀 使い方（定義と具体例）

基本的に、全ての作業は**変換したいファイル**や**実行したいこと**をバッチファイルに**ドラッグ＆ドロップ（マウスでつかんで離す）**するだけで始まります。

| ファイル名 | 目的（定義） | 使い方（具体例） |
| --- | --- | --- |
| `YouTube・TVer・ABEMAダウンロード用.bat` | **動画を保存する**。YouTube、TVer、ABEMAの動画をパソコンに保存できます。 | 1. ファイルを**ダブルクリック**で起動します。<br>2. 画面の指示に従い、見たい動画のURL（アドレス）を貼り付けて`Enter`キーを押します。<br>3. ダウンロードが終わると、**自動的に**ファイルが保存されます。 |
| `動画の拡張子を変更（未劣化）.bat` | **動画の「入れ物」を変える**。動画の画質を落とさず（再エンコードなし）、ファイル形式（例：.aviを.mp4に）を変えられます。 | 1. 形式を変えたい動画ファイルを、このアイコンに**ドラッグ＆ドロップ**します。<br>2. 画面で`mp4`や`mov`など、**変えたい形式の番号**を選びます。<br>3. 元のファイルと同じ場所に、新しい形式のファイルが作られます。 |
| `動画から音声抽出.bat` | **動画から音だけを取り出す**。ミュージックビデオなどから、音楽ファイル（MP3やWAV）だけを取り出せます。 | 1. 音声を取り出したい動画ファイルを、このアイコンに**ドラッグ＆ドロップ**します。<br>2. 画面で`MP3`か`WAV`か、**欲しい形式の番号**を選びます。<br>3. 動画から取り出された音楽ファイルが作られます。 |
| `音声の拡張子を変更（未圧縮）.bat` | **音楽ファイルの形式を変える**。MP3やWAVなど、音楽ファイルの形式を変更します。 | 1. 形式を変えたい音楽ファイルを、このアイコンに**ドラッグ＆ドロップ**します。<br>2. 画面で`mp3`や`flac`など、**変えたい形式の番号**を選びます。<br>3. **画質が変わる（再エンコード）ため、音質が少し変わる可能性があります。 |
| `画像形式変換.bat` | 写真やイラストの形式を変える。PNGやJPEGなど、画像ファイルの形式を変更します。 | 1. 形式を変えたい画像ファイルを、このアイコンに**ドラッグ＆ドロップ**します。<br>2. 画面で`JPEG`や`PNG`など、**変えたい形式の番号**を選びます。<br>3. 新しい形式の画像ファイルが作られます。 |
| `yt-dlp更新用.bat` | **動画ダウンロードの道具を最新にする**。ダウンロード機能が動かなくなった時に実行します。 | ファイルを**ダブルクリック**で起動します。画面が自動的に止まるので、内容を確認して、何かキーを押せば閉じます。 |

---

## 👨‍💻 エンジニア向け 説明書（README）

### 🎯 プロジェクト概要

提供された一連の`.bat`ファイルは、外部ツール（`yt-dlp`、`ffmpeg`、`ImageMagick`）のラッパーとして機能し、一般ユーザー向けにドラッグ＆ドロップ操作によるメディア処理を簡易化することを目的としています。すべてのバッチファイルは`setlocal enabledelayedexpansion` を使用し、処理の安定性を確保しています。

### 🛠️ 依存関係と環境

- **OS**: Windows環境
- **外部ツール（必須）**:
  - `yt-dlp.exe`
  - `ffmpeg.exe`
  - `magick.exe` (ImageMagick)

> **【依存ツールの配置】**
> 各バッチファイルは、最初に`where [ツール名]`コマンドで環境変数`%PATH%`内を検索し、ツールを見つけようと試みます。
> 検索に失敗した場合、ファイルによっては、バッチファイルと**同一のディレクトリ内に依存ツール（`.exe`ファイル）が配置されていること**を前提としたフォールバックチェックを行っています。
>
> ```batch
> where yt-dlp >nul 2>nul
> if %errorlevel% neq 0 (
>     if not exist "yt-dlp.exe" (
>         echo [ERROR] yt-dlp.exe not found.
>         echo Please place yt-dlp.exe in this folder.
>         pause
>         exit /b
>     )
> )
> ```
>
> 開発環境やデプロイ時には、これらの`.exe`ファイルをバッチファイルと同じフォルダに配置するか、実行環境の`%PATH%`を適切に設定する必要があります。

### 📂 主要機能と技術詳細

#### 1. 動画ダウンロード (`YouTube・TVer・ABEMAダウンロード用.bat`)

- **定義**: `yt-dlp`を使用した動画URLからのダウンロードスクリプト。
- **要点**:
  - URLパターンマッチングによるサービス判定 (`find /i`)。
  - **制約**: `amazon.co.jp`、`hulu.jp`のURLを検知した場合、DRM保護コンテンツとして警告し、処理を終了。
  - **YouTubeのライブ判定ロジック**: `yt-dlp --print "%%(is_live)s"`で判定し、`True`の場合、`--live-from-start`オプションを付加。
  - **エラー処理**: ダウンロード失敗時（`errorlevel neq 0`）に考えられる原因を表示。

#### 2. 動画の拡張子を変更（コンテナコピー） (`動画の拡張子を変更（未劣化）.bat`)

- **定義**: `ffmpeg -c copy`を使用し、再エンコードせずにコンテナ形式のみを変更する無劣化変換。
- **要点**:
  - 選択可能な形式: `.mp4`、`.mov`、`.webm`、`.mkv`。
  - コマンドオプション: `-i`（入力）、`-c copy`（ストリームコピー）、`-map 0`（全ストリーム）、`-y`（上書き）、`-loglevel error`。
  - **比較**: 再エンコードがないため高速ですが、元のコーデックがターゲットコンテナに対応していない場合、警告が表示される可能性があります。

#### 3. 動画から音声抽出 (`動画から音声抽出.bat`)

- **定義**: `ffmpeg`を使用して動画ファイルから音声ストリームを抽出。
- **要点**:
  - **MP3出力**: `-vn -acodec libmp3lame -q:a 2` (映像無効、LAME MP3エンコーダ、高品質VBR)。
  - **WAV出力**: `-vn -acodec pcm_s16le -ar 44100 -ac 2` (映像無効、16bit PCM、44.1kHz、ステレオ)。

#### 4. 音声の拡張子を変更（再エンコード） (`音声の拡張子を変更（未圧縮）.bat`)

- **定義**: `ffmpeg`を使用した再エンコードを伴う音声形式変換。
- **要点**:
  - 選択可能な形式: `.mp3`、`.wav`、`.aac`、`.flac`、`.m4a`。
  - 内部ロジックとしては、再エンコードを伴います。コマンドは`-i ... -y -loglevel error "%OUTPUT_FILE%"`で、標準のFFmpeg設定に依存しています。

#### 5. 画像形式変換 (`画像形式変換.bat`)

- **定義**: `ImageMagick`の`magick`コマンドを使用した画像形式の変換。
- **要点**:
  - 選択可能な形式: `.jpg`、`.png`、`.gif`、`.webp`、`.svg`、`.tiff`、`.bmp`。
  - コマンド: `magick "%INPUT_FILE%" "%OUTPUT_FILE%"`。ImageMagickの形式自動判定・変換機能を利用しています。

#### 6. yt-dlp更新 (`yt-dlp更新用.bat`)

- **定義**: `yt-dlp -U`によるシンプルかつ必須のアップデート処理。

### ⚙️ 改善点の提案

- **FFmpeg/yt-dlpのパス確認の改善**:
  - 現在、`where`コマンドで確認できない場合、同一フォルダの`.exe`をチェックしていますが、ユーザーが配置する可能性のある場所に**優先順位**をつけて検索するロジック（例：特定のカスタムディレクトリや`%PATH%`に追加されていない`AppDir`など）を追加することで、利便性が向上します。

- **エラーレベルのハンドリング強化**:
  - 現在、ほとんどの処理は`if %errorlevel% neq 0`で汎用的なエラーメッセージを出力しています。
  - FFmpegなどでは、より詳細なエラーコードやログを解析し、ネットワークエラー、コーデック非対応、ファイル破損などの具体的なメッセージを表示することで、ユーザーのデバッグ体験を改善できます。

- **ファイル名処理の堅牢性向上**:
  - ファイル名に特殊文字（`!`、`&`、`,`など）が含まれる場合の処理を、二重引用符の適切な使用や遅延環境変数（`!VAR!`）の使用をさらに徹底することで、より堅牢にできます。提供されたスクリプトでは大部分で考慮されていますが、潜在的な脆弱性を最小限に抑えるべきです。
